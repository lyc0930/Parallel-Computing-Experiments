# <center>实验 1</center>

##### <p align="right">PB17000297 罗晏宸</br>2020.7.7</p>

### 实验题目

利用 MPI，OpenMP 编写简单的程序，测试并行计算系统性能

- 求素数个数
- 求 $\pi$ 值

### 实验环境

#### 操作系统

Windows Subsystem for Linux: Ubuntu 18.04 LTS （内核版本 4.4.0-18362-Microsoft）

#### 编译环境

- g++ 7.5.0

- OpenMP 4.5.0

- MPICH 3.3a2

#### 硬件配置

​	Intel&reg;  Core&trade;  i5-7200U CPU

- 内核数：2
- 线程数：4（超线程）

## <center>求素数个数</center>

### <center>MPI 版本</center>

### 算法设计与分析

### 核心代码

### 实验结果

-  运行时间($\mu$s)

| 规模\进程数 | 1           | 2           | 4           | 8         |
| :---------- | ----------- | ----------- | ----------- | --------- |
| 1000        | 46.4916  | 19.9097 | 16.2326 | 1534.87 |
| 10000       | 354.115 | 242.335 | 184.510 | 45875.3 |
| 100000      | 7048.12  | 4073.26  | 4835.16  | 92092.8 |
| 500000      | 98943.0   | 54282.9  | 60606.0  | 116115.0 |
可以看到当进程数超过逻辑 CPU 核数（即线程数 4）时，运行时间显著增加，这是由于每个逻辑 CPU 核心同一时间内最多只能运行一个进程，当并行进程数超过线程数时，CPU 会进行多次进程间的切换调整多个进程的并行运行情况，而进程切换会消耗额外的时间。

- 加速比

| 规模\进程数 | 1    | 2       | 4       | 8          |
| ----------- | ---- | ------- | ------- | ---------- |
| 1000        | 1    | 2.33512 | 2.86408 | 0.0302903  |
| 10000       | 1    | 1.46126 | 1.91922 | 0.00771908 |
| 100000      | 1    | 1.73034 | 1.43768 | 0.0765328  |
| 500000      | 1    | 1.82273 | 1.63256 | 0.852115   |

### <center>OpenMP 版本</center>

### 算法设计与分析

### 核心代码

### 实验结果

-  运行时间($\mu$s)

| 规模\进程数 | 1          | 2          | 4           | 8          |
| :---------- | ---------- | ---------- | ----------- | ---------- |
| 1000        | 26.6  | 16.8994 | 13.0259 | 1738.9  |
| 10000       | 55.9  | 39.3701 | 28.6678 | 1431.72  |
| 100000      | 227.5 | 149.28 | 89.9875 | 6798.96 |
| 500000      | 1468.8  | 902.565 | 676.071 | 14083.5 |


- 加速比

| 规模\进程数 | 1    | 2       | 4       | 8          |
| ----------- | ---- | ------- | ------- | ---------- |
| 1000        | 1    | 1.57402 | 2.04208 | 0.015297  |
| 10000       | 1    | 1.41986 | 1.94992 | 0.039044 |
| 100000      | 1    | 1.52398 | 2.52813 | 0.033461  |
| 500000      | 1    | 1.62703 | 2.17211 | 0.104271   |


## <center>求 $\pi$ 值</center>

### <center>MPI 版本</center>

### 算法设计与分析

### 核心代码

### 实验结果

-  运行时间($\mu$s)

| 规模\进程数 | 1           | 2           | 4           | 8         |
| :---------- | ----------- | ----------- | ----------- | --------- |
| 1000        | 164.133  | 120.561 | 55.9976 | 2762.8 |
| 10000       | 223.241 | 197.662 | 115.824 | 200684.0 |
| 50000       | 2675.77  | 1747.49 | 1082.6 | 70078.6 |
| 100000      | 13824.2   | 10081.8 | 4358.05 | 71824.7 |
可以看到当进程数超过逻辑 CPU 核数（即线程数 4）时，运行时间显著增加，这是由于每个逻辑 CPU 核心同一时间内最多只能运行一个进程，当并行进程数超过线程数时，CPU 会进行多次进程间的切换调整多个进程的并行运行情况，而进程切换会消耗额外的时间。

- 加速比

| 规模\进程数 | 1    | 2       | 4       | 8          |
| ----------- | ---- | ------- | ------- | ---------- |
| 1000        | 1    | 1.36141 | 2.93107 | 0.0594082  |
| 10000       | 1    | 1.12941 | 1.92741 | 0.0011124  |
| 50000       | 1    | 1.53121 | 2.47162 | 0.0381824  |
| 100000      | 1    | 1.37121 | 3.17211 | 0.1924715  |

### <center>OpenMP 版本</center>

### 算法设计与分析

### 核心代码

### 实验结果

-  运行时间($\mu$s)

| 规模\进程数 | 1          | 2          | 4           | 8          |
| :---------- | ---------- | ---------- | ----------- | ---------- |
| 1000        |   162.7  |  97.59  |  44.29   |  671.8  |
| 10000       |   427.9  |  379.7  |  120.2   |  733.9  |
| 100000      |  2929.69 | 1732.28 |  876.832 | 23952.0 |
| 500000      | 14648.4  | 8407.46 | 4413.47  | 20604.8 |


- 加速比

| 规模\进程数 | 1    | 2       | 4       | 8          |
| ----------- | ---- | ------- | ------- | ---------- |
| 1000        | 1    | 1.66718 | 3.67352 | 0.242185  |
| 10000       | 1    | 1.12694 | 3.55992 | 0.583049 |
| 100000      | 1    | 1.69123 | 3.34122 | 1.50001  |
| 500000      | 1    | 1.74231 | 3.31902 | 0.710921   |